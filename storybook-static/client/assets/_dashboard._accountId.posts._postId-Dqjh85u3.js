import{h as q,g as f,j as s,r as _,m as D,f as Q}from"./main-fcwEEnio.js";import{u as w}from"./useQuery-9ZSytB9M.js";import{d as S,r as N,a as T,b as A,u as E,f as F}from"./fetchers-Bgk8xZB4.js";import{u as h}from"./useMutation-HRP94QFy.js";import"./preload-helper-BXl3LOEh.js";const P=({postId:e,accountId:n})=>{const u=q(),a=f(),o=h({mutationFn:()=>S(n,e),onSuccess:()=>{a.invalidateQueries({queryKey:["posts",n]}),u({to:"/$accountId/posts",params:{accountId:n}})},onError:()=>{alert("Failed to delete API. Please try again later.")}}),r=()=>{confirm(`Are you sure you want to delete the post /${n}/${e}? This action cannot be undone.`)&&o.mutate()};return s.jsx("button",{className:"underline text-red-600 w-fit",onClick:r,disabled:o.isPending,children:o.isPending?"Deleting...":"Delete API"})};P.__docgenInfo={description:"",methods:[],displayName:"DeletePostButton",props:{accountId:{required:!0,tsType:{name:"string"},description:""},postId:{required:!0,tsType:{name:"string"},description:""}}};function x({text:e}){return s.jsx("span",{children:e})}x.__docgenInfo={description:"",methods:[],displayName:"CopyUrlSnippet",props:{text:{required:!0,tsType:{name:"string"},description:""}}};function C({accountId:e,postId:n}){const u=async()=>{try{await N(e,n),alert("success!")}catch{alert("failed :/")}};return s.jsx("button",{onClick:()=>u(),className:"border w-fit hover:underline",children:"Republish"})}C.__docgenInfo={description:"",methods:[],displayName:"PostRepublish",props:{accountId:{required:!0,tsType:{name:"string"},description:""},postId:{required:!0,tsType:{name:"string"},description:""}}};function v({accountId:e,postId:n,categories:u}){const[a,o]=_.useState(""),r=f(),l=t=>{const i=t.trim();return i?/^[a-zA-Z0-9]+$/.test(i)?u.some(p=>p.toLowerCase()===i.toLowerCase())?"Category already exists":null:"Category must be alphanumeric only":"Category cannot be empty"},c=h({mutationFn:t=>T(e,n,t),onMutate:async t=>{await r.cancelQueries({queryKey:["posts",e]});const i=r.getQueryData(["posts",e]);return r.setQueryData(["posts",e],p=>p.map(m=>m.doc_api_name===n?{...m,categories:[...m.categories??[],t]}:m)),{previousPosts:i}},onError:(t,i,p)=>{r.setQueryData(["posts",e],p?.previousPosts),alert("Failed to add category :/")},onSettled:()=>{r.invalidateQueries({queryKey:["posts",e]})},onSuccess:()=>{o("")}}),d=h({mutationFn:t=>A(e,n,t),onMutate:async t=>{await r.cancelQueries({queryKey:["posts",e]});const i=r.getQueryData(["posts",e]);return r.setQueryData(["posts",e],p=>p.map(m=>m.doc_api_name===n?{...m,categories:(m.categories??[]).filter(j=>j!==t)}:m)),{previousPosts:i}},onError:(t,i,p)=>{r.setQueryData(["posts",e],p?.previousPosts),alert("Failed to remove category :/")},onSettled:()=>{r.invalidateQueries({queryKey:["posts",e]})}}),y=()=>{if(!a.trim())return;const t=l(a);if(t){alert(t);return}c.mutate(a)},g=t=>{confirm("are u sure u want to delete")&&d.mutate(t)};return s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("input",{value:a,onChange:t=>o(t.target.value),placeholder:"E.g. 'metro'",className:"border",onKeyDown:t=>t.key==="Enter"&&y(),disabled:c.isPending}),s.jsx("button",{onClick:y,className:"border",disabled:c.isPending,children:c.isPending?"Adding...":"Add"}),u.map((t,i)=>s.jsx("button",{onClick:()=>g(t),className:"border",children:s.jsx("span",{children:t})},i))]})}v.__docgenInfo={description:"",methods:[],displayName:"PostCategories",props:{accountId:{required:!0,tsType:{name:"string"},description:""},postId:{required:!0,tsType:{name:"string"},description:""},categories:{required:!0,tsType:{name:"Array",elements:[{name:"any"}],raw:"any[]"},description:""}}};function b({accountId:e,postId:n,initialSlug:u}){const[a,o]=_.useState(u),r=f(),l=h({mutationFn:d=>E(e,n,d),onMutate:async d=>{await r.cancelQueries({queryKey:["posts",e]});const y=r.getQueryData(["posts",e]);return r.setQueryData(["posts",e],g=>g.map(t=>t.doc_api_name===n?{...t,slug:d}:t)),{previousPosts:y}},onError:(d,y,g)=>{r.setQueryData(["posts",e],g?.previousPosts),alert("Failed to update slug :/")},onSettled:()=>{r.invalidateQueries({queryKey:["posts",e]})}}),c=()=>{a.trim()&&l.mutate(a)};return s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("input",{value:a,onChange:d=>o(d.target.value),className:"border",onKeyDown:d=>d.key==="Enter"&&c(),disabled:l.isPending}),s.jsx("button",{onClick:c,className:"border",disabled:l.isPending,children:l.isPending?"Updating...":"Update"})]})}b.__docgenInfo={description:"",methods:[],displayName:"PostSlug",props:{accountId:{required:!0,tsType:{name:"string"},description:""},postId:{required:!0,tsType:{name:"string"},description:""},initialSlug:{required:!0,tsType:{name:"string"},description:""}}};function U(){const{accountId:e,postId:n}=D.useParams(),{data:u,isLoading:a}=w({queryKey:["posts",e],queryFn:()=>F(e),initialData:[]}),o=u.find(c=>c.doc_api_name===n);if(!o||a)return s.jsx(s.Fragment,{children:"loading..."});const r=`https://docs.google.com/document/d/${o.google_doc_id}`,l=`${Q.api.url}/${e}/doc/${o.doc_api_name}`;return s.jsxs("div",{className:"flex flex-col border space-y-2",children:[s.jsx("h2",{children:"Post"}),s.jsxs("h3",{children:["/doc/",o.doc_api_name]}),s.jsx("a",{href:r,target:"_blank",children:"View Source Google Document"}),s.jsx(x,{text:l}),s.jsx(C,{accountId:e,postId:n}),s.jsx(b,{accountId:e,postId:n,initialSlug:o.slug??o.doc_api_name}),s.jsx(v,{accountId:e,postId:n,categories:o.categories??[]}),s.jsx(P,{postId:o.doc_api_name,accountId:e})]})}export{U as component};
